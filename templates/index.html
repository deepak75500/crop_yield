<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense Tracker</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <h1>Expense & Optimization Suite â€” Expense Tracker</h1>
    <p>Preloaded with sample records. Add your own expenses and view charts.</p>

    <!-- Form -->
    <form id="expenseForm" class="form-grid">
      <div>
        <label>Date</label>
        <input type="date" id="date" required>
      </div>
      <div>
        <label>Category</label>
        <select id="category">
          <option>Seeds</option>
          <option>Fertilizers</option>
          <option>Pesticides</option>
          <option>Labor</option>
          <option>Equipment</option>
          <option>Other</option>
        </select>
      </div>
      <div>
        <label>Amount (USD)</label>
        <input type="number" step="0.01" id="amount" placeholder="0.00" required>
      </div>
      <div>
        <label>Notes</label>
        <input type="text" id="notes" placeholder="Optional">
      </div>
      <div class="form-actions">
        <button type="submit" id="submitBtn">Add Record</button>
        <button type="button" id="clearBtn">Clear</button>
        <button type="button" id="exportBtn">Export CSV</button>
      </div>
    </form>

    <!-- Charts -->
    <div class="charts">
      <div>
        <h3>Category Breakdown</h3>
        <canvas id="pieChart"></canvas>
      </div>
      <div>
        <h3>Monthly Spending Overview</h3>
        <canvas id="lineChart"></canvas>
      </div>
    </div>

    <!-- Table -->
    <div class="table-container">
      <div class="table-filters">
        <input type="text" id="search" placeholder="Search records...">
        <select id="filterCategory">
          <option value="All">All</option>
          <option>Seeds</option>
          <option>Fertilizers</option>
          <option>Pesticides</option>
          <option>Labor</option>
          <option>Equipment</option>
          <option>Other</option>
        </select>
        <span id="totalAmount"></span>
      </div>
      <table id="recordsTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Category</th>
            <th>Amount</th>
            <th>Notes</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
<style>
    body {
  font-family: Arial, sans-serif;
  background: #f0f8ff;
  padding: 20px;
  color: #111;
}

.container {
  max-width: 1200px;
  margin: auto;
}

h1 {
  font-size: 24px;
  margin-bottom: 4px;
}
p {
  color: #555;
  margin-bottom: 20px;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 10px;
  background: white;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
}

.form-grid div {
  display: flex;
  flex-direction: column;
}
.form-actions {
  grid-column: 1 / -1;
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

button {
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid #888;
  cursor: pointer;
  background: #fff;
}
button:hover {
  background: #eee;
}

.charts {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}
.charts > div {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  flex: 1 1 300px;
}

.table-container {
  background: #fff;
  border-radius: 10px;
  padding: 15px;
}

.table-filters {
  display: flex;
  gap: 10px;
  align-items: center;
  margin-bottom: 10px;
}

input, select {
  padding: 6px 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
th, td {
  padding: 6px 10px;
  border-bottom: 1px solid #ddd;
}
th {
  background: #f9f9f9;
  text-align: left;
}

</style>
<script>
    const STORAGE_KEY = "expense_tracker_records_v1";
const CATEGORIES = ["Seeds","Fertilizers","Pesticides","Labor","Equipment","Other"];
let records = [];
let editingId = null;

const DEFAULT_DATA = [
  { date: "2025-01-10", category: "Seeds", amount: 120.5, notes: "Corn seeds" },
  { date: "2025-01-12", category: "Fertilizers", amount: 85.75, notes: "Nitrogen fertilizer" },
  { date: "2025-02-03", category: "Labor", amount: 200, notes: "Planting work" },
  { date: "2025-02-18", category: "Equipment", amount: 350, notes: "Tractor maintenance" },
  { date: "2025-03-05", category: "Pesticides", amount: 90, notes: "Insect control" },
  { date: "2025-03-15", category: "Seeds", amount: 140, notes: "Rice seeds" },
  { date: "2025-04-02", category: "Labor", amount: 220, notes: "Field irrigation" },
  { date: "2025-04-20", category: "Fertilizers", amount: 95.5, notes: "Organic compost" },
  { date: "2025-05-08", category: "Pesticides", amount: 75, notes: "Weed control" },
  { date: "2025-05-25", category: "Equipment", amount: 500, notes: "New plow" },
  { date: "2025-06-10", category: "Seeds", amount: 110, notes: "Vegetable seeds" },
  { date: "2025-06-22", category: "Labor", amount: 240, notes: "Harvesting help" },
  { date: "2025-07-04", category: "Other", amount: 60, notes: "Fuel for machinery" },
  { date: "2025-07-19", category: "Fertilizers", amount: 105, notes: "Phosphate" },
  { date: "2025-08-01", category: "Seeds", amount: 130, notes: "Wheat seeds" },
  { date: "2025-08-18", category: "Pesticides", amount: 95, notes: "Fungicide" },
  { date: "2025-09-03", category: "Equipment", amount: 400, notes: "Irrigation pump repair" },
  { date: "2025-09-25", category: "Labor", amount: 250, notes: "Field cleanup" },
  { date: "2025-10-05", category: "Other", amount: 80, notes: "Transportation" },
];

// Elements
const form = document.getElementById("expenseForm");
const dateInput = document.getElementById("date");
const categoryInput = document.getElementById("category");
const amountInput = document.getElementById("amount");
const notesInput = document.getElementById("notes");
const submitBtn = document.getElementById("submitBtn");
const clearBtn = document.getElementById("clearBtn");
const exportBtn = document.getElementById("exportBtn");
const tableBody = document.querySelector("#recordsTable tbody");
const searchInput = document.getElementById("search");
const filterCategory = document.getElementById("filterCategory");
const totalAmountEl = document.getElementById("totalAmount");

// Charts
let pieChart, lineChart;

// Utility
function uid() { return Math.random().toString(36).slice(2,9); }
function formatCurrency(num) { return "$" + Number(num).toFixed(2); }

// Load Records
function loadRecords() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw) {
    records = JSON.parse(raw);
  } else {
    records = DEFAULT_DATA.map(r => ({id: uid(), ...r}));
    localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
  }
}
function saveRecords() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
}

// Reset form
function resetForm() {
  editingId = null;
  dateInput.value = new Date().toISOString().slice(0,10);
  categoryInput.value = "Seeds";
  amountInput.value = "";
  notesInput.value = "";
  submitBtn.textContent = "Add Record";
}

// Render Table
function renderTable() {
  const query = searchInput.value.toLowerCase();
  const filtered = records
    .filter(r => filterCategory.value === "All" ? true : r.category === filterCategory.value)
    .filter(r => r.category.toLowerCase().includes(query) || (r.notes||"").toLowerCase().includes(query) || r.date.includes(query) || String(r.amount).includes(query))
    .sort((a,b) => new Date(b.date) - new Date(a.date));
  
  tableBody.innerHTML = "";
  if(filtered.length===0) {
    tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#888;">No records found.</td></tr>`;
  } else {
    filtered.forEach(r=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.date}</td>
        <td>${r.category}</td>
        <td>${formatCurrency(r.amount)}</td>
        <td>${r.notes || ""}</td>
        <td>
          <button class="editBtn">Edit</button>
          <button class="deleteBtn">Delete</button>
        </td>`;
      tr.querySelector(".editBtn").addEventListener("click",()=>editRecord(r.id));
      tr.querySelector(".deleteBtn").addEventListener("click",()=>deleteRecord(r.id));
      tableBody.appendChild(tr);
    });
  }

  totalAmountEl.textContent = "Total: " + formatCurrency(records.reduce((s,r)=>s+Number(r.amount||0),0));
}

// Edit/Delete
function editRecord(id) {
  const rec = records.find(r=>r.id===id);
  if(!rec) return;
  editingId = id;
  dateInput.value = rec.date;
  categoryInput.value = rec.category;
  amountInput.value = rec.amount;
  notesInput.value = rec.notes || "";
  submitBtn.textContent = "Update Record";
}

function deleteRecord(id) {
  if(!confirm("Delete this record?")) return;
  records = records.filter(r=>r.id!==id);
  saveRecords();
  renderTable();
  renderCharts();
}

// Charts
function renderCharts() {
  // Category Pie
  const categoryTotals = {};
  CATEGORIES.forEach(c=>categoryTotals[c]=0);
  records.forEach(r=>categoryTotals[r.category]=(categoryTotals[r.category]||0)+Number(r.amount||0));
  
  const pieData = {
    labels: Object.keys(categoryTotals),
    datasets:[{
      data:Object.values(categoryTotals),
      backgroundColor:["#4F46E5","#06B6D4","#F97316","#10B981","#EF4444","#A78BFA"]
    }]
  };
  if(pieChart) pieChart.destroy();
  pieChart = new Chart(document.getElementById("pieChart"), { type:'pie', data: pieData });

  // Monthly Line
  const monthMap = {};
  records.forEach(r=>{
    const key = r.date.slice(0,7);
    monthMap[key] = (monthMap[key]||0) + Number(r.amount||0);
  });
  const months = Object.keys(monthMap).sort();
  const lineData = {
    labels: months,
    datasets:[{
      label:"Total",
      data: months.map(m=>monthMap[m].toFixed(2)),
      borderColor:"#4F46E5",
      backgroundColor:"rgba(79,70,229,0.2)",
      fill:true,
      tension:0.3
    }]
  };
  if(lineChart) lineChart.destroy();
  lineChart = new Chart(document.getElementById("lineChart"), { type:'line', data: lineData, options:{plugins:{legend:{display:false}}}});
}

// CSV Export
function exportCSV() {
  const header = ["id","date","category","amount","notes"];
  const rows = records.map(r=>[r.id,r.date,r.category,r.amount,`"${(r.notes||"").replace(/"/g,'""')}"`]);
  const csv = [header.join(","), ...rows.map(r=>r.join(","))].join("\n");
  const blob = new Blob([csv], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "expense_records.csv";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

// Form Submit
form.addEventListener("submit", e=>{
  e.preventDefault();
  const date = dateInput.value;
  const category = categoryInput.value;
  const amount = parseFloat(amountInput.value);
  const notes = notesInput.value;
  if(!date || !category || isNaN(amount)) return alert("Please enter valid date, category, amount.");

  if(editingId) {
    records = records.map(r=>r.id===editingId ? {...r,date,category,amount,notes} : r);
  } else {
    records.push({id:uid(),date,category,amount,notes});
  }
  saveRecords();
  renderTable();
  renderCharts();
  resetForm();
});

// Clear button
clearBtn.addEventListener("click", resetForm);

// Export button
exportBtn.addEventListener("click", exportCSV);

// Search & Filter
searchInput.addEventListener("input", renderTable);
filterCategory.addEventListener("change", renderTable);

// Init
loadRecords();
renderTable();
renderCharts();
resetForm();

</script>